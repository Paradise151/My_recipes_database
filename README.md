## **Часть 1. Информационная модель базы данных кулинарных рецептов.**  
База данных моих скромных рецептов. Зачем это?
1) Прикольно. Готовка бывает веселой и прекрасной, особенно если готовит Гордон Рамзи.  
2) Чтобы в чём-то разобраться, надо: a) своими словами мочь рассказать, b) обдумать основные проблемы – суть дела, c) разобраться, почему основные моменты вообще стали таковыми (т.е. понять причины их появления — "эволюционная ретроспектива") и d) используя имеющиеся знания, закрепить их, реализуя нечто тебе приятное и их включающее.  
Значит, чтобы получше в SQL стать, надо настругать таблички и позаполнять их.  

Таковыми табличками, под управлением базы данных, будут составляющие процесса приготовления.
На важный самостоятельный объект будет создаваться своя таблица.

Что это за объекты?  
Рецепт включает: ингредиенты, время готовки, последовательность шагов (что с ингредиентами делают) и т.д..  
Значит, **ингредиенты** помещаются в отдельную таблицу (1).  
Последовательность шагов — отдельная таблица, именуемая **шагами готовки** (2).  
Теперь, что пишется в рецепте — например, взяли мясо и отбили его или порезали.  И что же получается, надо в каждую строку подобное писать? А если ошибки будут или решишь по-другому назвать; тогда возникнет хаос! Как потом из этого общую информацию извлекать?! Для систематизации декомпозируем шаги готовки и выделим из них группы с общими свойствами, которые и станут нашими новыми объектами.  
Получаем такие объекты, как **духовка** (3), **плита** (4), **мультиварка** (5), **микроволновка** (6), **холодная готовка** (7) — сюда относятся всякие отбивания, промывания, нарезания, в общем, что выполняется человеком.  
Затем надо как-то систематизировать сами ингредиенты, у них же тоже общие свойства есть. Таким образом, появляется таблица **тип ингредиентов** (8), в которой содержатся такие вещи, как специи, мясо, овощи,  рыба и т.д..  
Названия самих блюд будут исходить из **таблицы рецепты** (9). Можно было бы объединить *таблицу рецептов* (9) и *таблицу шагов готовки* (2), но рецепт содержит автора и некоторый комментарий, может ещё  содержать год создания; также одно блюдо может иметь разные рецепты, а значит, одного названия блюда недостаточно для корректной связки шагов по приготволению блюда с его рецептом; поэтому надо использовать именно индекс рецепта!   
Мы хотим, чтобы в *таблице шаги готовки* (2) был один унифицированный столбик, отвечающий за физическое взаимодействие с ингредиентом; поэтому создадим **таблицу шагов** (10), в которой будут содержаться все  возможные действия с ингредиентами (эти действия будут получаться по индексам из таблиц *холодная готовка*, *плита*, *духовка* и т.д.). Безусловно, можно было бы не создавать *таблицу шагов* (10) и объединить  её с *шагами готовки* (2), но тогда в последней (2) было бы на 4 столбца больше и снизился бы её "кулинарный" (схематичный) вид.  
Помимо прочего, у каждого рецепта есть и свой скромный автор, поэтому создадим **таблицу авторов** (11). Также весьма усместным была бы **таблица тип блюда** (12), например, гарнир, первое блюдо...

## **Часть 2. Краткое описание таблиц и их связей.**  
Таблицы **духовка** (3), **мультиварка** (5), **плита** (4), **микроволновка** (6), **холодная готовка** (7) одинаковы по строению: содержат первичный ключ и название режима (name_mode). Таблица **шаги** (10) ссылается на первичные ключи вышеописанных таблиц средств готовки (4 внешних ключа) и содержит первичный ключ (step_id). Таблица **авторов** (11), помимо первичного ключа, включает имя автора (name_author). Таблица **тип блюда** (12), содержащая первичный ключ, включает название типа блюда (name_dish_type). Таблица **рецептов** (9) ссылается на первичные ключи таблицы авторов и типов блюда, также она содержит следующие атрибуты: название рецепта (name_recipe), число порций (number_of_servings), первичный ключ (recipe_id) и комментарий к рецепту (description). Таблица **тип ингредиентов** (8) имеет первичный ключ и название типа (name_ingredient_type). Таблица **ингредиенты** (1) ссылается на первичный ключ таблицы тип ингредиентов и включает название ингредиента (name_ingredient). И, напоследок, таблица **шагов готовки** (2) ссылается на первичные ключи трёх таблиц: - ингредиенты, шаги готовки и рецепты. И, помимо первичного ключа, содержит следующие атрибуты: число частей (pieces, может быть как штуками, так и долями, например, 1.5 порции воды на 1 порцию риса), вес в кг (weight_kg), время готовки в минутах (cooking_time_minute), температура (temperature_celcius), уровень духовки снизу (oven_level_from_bottom) и давление (специально для мультиварки).  
  
Таким образом, получаем следующую архитектуру базы данных (ER-диаграмму):
![ER диаграмма базы данных рецептов](https://github.com/Paradise151/My_recipes_database/blob/main/ER%20diagram%20of%20Recipe%20DB.png)
## **Часть 3. Шаблоны.**  
Заметим, что в процессе заполнения таблицы и написания к ней запросов некоторые части кода повторяются. Назовём их шаблонами и выпишем. Жирным обозначим моменты в шаблонах, на которые стоит обратить внимание.
В readme.md ограничимся описанием главного шаблона вставки строки рецепта.  
...    
8. Шаблон №8 “Заполнение таблицы recipe_steps”

Для заполнения таблицы с точки зрения недопущения ошибок при присваивании атрибуту некоторого значения отлично подходит обновление с указанием какому столбцу какое значение присваивается.  
Но дабы избежать лишних запросов на обновление, будем сразу все атрибуты в таблицу recipe_steps вставлять.  

INSERT INTO recipe_steps(  
    recipe_id,  
    ingredient_id,  
    pieces,  
    weight_kg,  
    step_id,  
    cooking_time_minute,  
    temperature_celcius,    
    oven_level_from_bottom,  
    pressure)  
VALUES  
(  
(SELECT recipe_id FROM recipe WHERE name_recipe = 'Картофель бейби в духовке'),  -- recipe_id  
(SELECT ingredient_id FROM ingredient WHERE name_ingredient  = 'Картофель бейби'),  -- ingredient_id  
NULL,  -- pieces  
NULL,  -- weight_kg  
(SELECT step_id    
 FROM step   
	 LEFT JOIN  cold_preparation USING(cold_preparation_id)  
	 LEFT JOIN  multicooker USING(multicooker_id)  
	 LEFT JOIN  microwave USING(microwave_id)  
	 LEFT JOIN oven USING(oven_id)  
	 LEFT JOIN cooktop USING(cooktop_id)  
 WHERE cold_preparation.name_mode = 'Поместить в пакет для запекания'),   -- step_id  
4,  -- cooking_time_minute  
NULL,  -- temperature_celcius  
NULL,  -- oven_level_from_bottom  
NULL  -- pressure  
);  

Хорошо, но на одну строку очень много муторного кода, который приходится копировать и заполнять десятки раз. Лучше оформить это в виде функции (процедуры), получающие некоторые параметры, которые в прошлом приходилось перекопировать или искать место и вписывать. Вот что получилось:  

CALL InsertRecipeStep(  
    'Котлеты из индейки (с хлебом) в духовке',  -- recipe_name  
    'Белый хлеб',                               -- ingredient_name  
    1,                                       -- pieces  
    0.150,                                       -- weight_kg  
    'Положить/Налить в миску',                          -- step_mode  
    1,                                          -- cooking_time  
    NULL,                                       -- temperature  
    NULL,                                       -- oven_level  
    NULL,                                       -- pressure  
    'cold_preparation'                                      -- appliance_type  
);    

Круто, очень эстетично и даёт выйгрыш в 17 строк!

## **Часть 4. Рецепты.**
Ура, добрались и до самих рецептов!  

**Список имеющихся рецептов**  
|Номер_блюда|Название_блюда                              |
|-----------|--------------------------------------------|
|1          |Мясо по-французски                          |
|2          |Рис в мультиварке                           |
|3          |Перловка в мультиварке                      |
|4          |Бургерные котлеты                           |
|5          |Суп из замороженных овощей                  |
|6          |Суп Греческий с орзо и пряными травами Yelli|
|7          |Спагетти альденте с томатным соусом Barilla |
|8          |Котлеты из индейки (с хлебом) в духовке     |
|9          |Куриная печень в сметанном соусе            |
|10         |Картофель бейби в духовке                   |
|11         |Гречка в мультиварке                        |


**Справочная информация по рецептам** 
|Тип_блюда|Название_блюда                              |Время_готовки|Количество_порций|Вегетарианское|Описание_блюда                                                                                                                                                                                                                                                                        |
|---------|--------------------------------------------|-------------|-----------------|--------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|Гарнир   |Рис в мультиварке                           |16.00        |12               |Да            |Рис в мультиварке - блюдо, не требующее усилий и какого-либо контроля. Но оно коварное - может получиться как переваренным, так и суховатым. Будьте начеку.                                                                                                                           |
|Гарнир   |Перловка в мультиварке                      |14.00        |10               |Да            |Приготовление перловки в мультиварке сохраняет знакомый и любимый нами вкус, при этом значительно экономя время. Вместо стандартных 50–60 минут варки на плите, весь процесс в мультиварке занимает всего около 30 минут, из которых непосредственно на готовку уходит около 10 минут.|
|Гарнир   |Спагетти альденте с томатным соусом Barilla |32.00        |9                |Да            |Приятный итальянский гарнир. Особо приятен сразу после приготовления. Не жалейте томатный соус. Вместе с хорошей отбивной позволит вам забыть о всех невзгодах.                                                                                                                       |
|Гарнир   |Картофель бейби в духовке                   |72.50        |7                |Да            |Картофель по-деревенски. И этим всё сказано.                                                                                                                                                                                                                                          |
|Гарнир   |Гречка в мультиварке                        |19.00        |9                |Да            |Если не хотите стоять у плиты или боитесь, что гречка подгорит, то рецепт для вас. Но учтите, что она вероятно переварится.                                                                                                                                                           |
|Основное блюдо|Мясо по-французски                          |82.00        |12               |Нет           |Чудесное, сытное, мягкое и сочное праздничное блюдо. Мясо по-французски никого не оставит равнодушным.                                                                                                                                                                                |
|Основное блюдо|Бургерные котлеты                           |64.00        |10               |Нет           |Вдохновившись котлетами из бургеров, я придумал сделать из них самостоятельное блюдо. Тонкие и с дымком, бургерные котлеты позволяют быстро и с удовольствием перекусить в любое время суток.                                                                                         |
|Основное блюдо|Котлеты из индейки (с хлебом) в духовке     |63.00        |15               |Нет           |Котлеты с добавлением хлеба вас не подведут и позволят в течении нескольких сытно кушать.                                                                                                                                                                                             |
|Первое блюдо|Суп из замороженных овощей                  |24.00        |8                |Да            |Удивительно приятное и простое блюдо. Овощной супчик - самое то, когда устал от замысловатых и тяжелых блюд.                                                                                                                                                                          |
|Первое блюдо|Суп Греческий с орзо и пряными травами Yelli|39.00        |10               |Да            |Сытный суп с насыщенным вкусом душистых трав и пастой Орзо. Сухой набор удобно приготовить самостоятельно, главное — следить, чтобы паста не переварилась. Дополнить любимую порцию можно ложечкой охлаждённой сметаны.                                                               |

**Пример рецепта. Гречка в мультиварке**

|step_number|recipe                                      |name_ingredient|pieces|weight_kg|step                                                                                                                                                                                                                                                                                  |cooking_time_minute|temperature_celcius|oven_level_from_bottom|pressure|
|-----------|--------------------------------------------|---------------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------|-------------------|----------------------|--------|
|1          |Гречка в мультиварке                        |Гречка         |1.00  |0.350    |Помыть                                                                                                                                                                                                                                                                                |3.00               |NULL               |NULL                  |NULL    |
|2          |Гречка в мультиварке                        |Гречка         |NULL  |NULL     |Поместить в мультиварку                                                                                                                                                                                                                                                               |NULL               |NULL               |NULL                  |NULL    |
|3          |Гречка в мультиварке                        |Вода питьевая  |1.50  |0.750    |Добавить воды                                                                                                                                                                                                                                                                         |2.00               |NULL               |NULL                  |NULL    |
|4          |Гречка в мультиварке                        |Соль           |NULL  |NULL     |Посолить                                                                                                                                                                                                                                                                              |1.00               |NULL               |NULL                  |NULL    |
|5          |Гречка в мультиварке                        |Полученное блюдо|NULL  |NULL     |Мультиварка: Варка/Пар                                                                                                                                                                                                                                                                |13.00              |NULL               |NULL                  |3       |

Чтобы посмотреть рецепты интересующих блюд, нужно вписать название блюда в третьем запросе из файла (Распечатка информации по рецептам).

## **Часть 5. Техническая информация по базе данных рецептов.**
Данная база создана и заполнена с помощью языка MySQL в программе MySQL Workbench.  
Если захотите себе скачать и дополнить или создать свою базу данных рецептов, то можете всязть мою за основу.  
1. Файл "[Создание базы данных рецептов (без хода готовки).sql](https://github.com/Paradise151/My_recipes_database/blob/main/%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20%D1%80%D0%B5%D1%86%D0%B5%D0%BF%D1%82%D0%BE%D0%B2%20(%D0%B1%D0%B5%D0%B7%20%D1%85%D0%BE%D0%B4%D0%B0%20%D0%B3%D0%BE%D1%82%D0%BE%D0%B2%D0%BA%D0%B8).sql)" создаёт БД и таблицы в ней. Заполняет все таблицы кроме таблицы **recipe_steps** (по сути это зашифрованная кулинарная книга).
2. Далее рекомендуется выполнить файл "[recipe procedure for insertion InsertRecipeStep.sql](https://github.com/Paradise151/My_recipes_database/blob/main/recipe%20procedure%20for%20insertion%20InsertRecipeStep.sql)", создающий процедуру по вставке шага рецепта в таблицу **recipe_steps** (как выше сообщалось, это упрощает вставку). Один рецепт вставляется в таблицу с помощью данной процедуры (его можете взять за основу) "[Пример процедурного заполнения рецепта (куриные хлебные котлеты).sql](https://github.com/Paradise151/My_recipes_database/blob/main/%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80%20%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D0%B4%D1%83%D1%80%D0%BD%D0%BE%D0%B3%D0%BE%20%D0%B7%D0%B0%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F%20%D1%80%D0%B5%D1%86%D0%B5%D0%BF%D1%82%D0%B0%20(%D0%BA%D1%83%D1%80%D0%B8%D0%BD%D1%8B%D0%B5%20%D0%BA%D0%BE%D1%82%D0%BB%D0%B5%D1%82%D1%8B%20%D1%81%20%D1%85%D0%BB%D0%B5%D0%B1%D0%BE%D0%BC).sql)".
3. Для "топорного" заполнения таблицы recipe_steps выполните все файлы из папки "[various recipes](https://github.com/Paradise151/My_recipes_database/tree/main/various%20recipes)". 
4. Для "красивого" отображения информации по рецептам выполните файл "[Распечатка информации по рецепту.sql](https://github.com/Paradise151/My_recipes_database/blob/main/%D0%A0%D0%B0%D1%81%D0%BF%D0%B5%D1%87%D0%B0%D1%82%D0%BA%D0%B0%20%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D0%B8%20%D0%BF%D0%BE%20%D1%80%D0%B5%D1%86%D0%B5%D0%BF%D1%82%D1%83.sql).

Вот и все дела :)  
